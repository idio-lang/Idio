;;
;; Copyright (c) 2015 Ian Fitchet <idf(at)idio-lang.org>
;;
;; Licensed under the Apache License, Version 2.0 (the "License"); you
;; may not use this file except in compliance with the License.  You
;; may obtain a copy of the License at
;;
;;     http://www.apache.org/licenses/LICENSE-2.0
;;
;; Unless required by applicable law or agreed to in writing, software
;; distributed under the License is distributed on an "AS IS" BASIS,
;; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
;; See the License for the specific language governing permissions and
;; limitations under the License.
;;
;;

;;
;; env.idio
;;

;; XXX we're not guaranteed any real environment variables but the
;; internals should have cooked up an interim PATH and IDIOLIB if
;; there isn't anything else
test (gt (string-length PATH) 0) #t

{
  ; create a env and test it's the same
  MYPATH :* PATH
  test (gt (string-length MYPATH) 0) #t
  test MYPATH PATH

  {
    ;; in a sub-frame test we're still available
    test MYPATH PATH

    ;; unset it
    !* MYPATH
    test (unset? MYPATH) #t
  }

  ;; outside the sub-frame test we're available again
  test MYPATH PATH

}

;; outside of the frame using our environ variable should generate an
;; ^rt-environ-variable-unbound-error
monitor (function (cont cond) {
  test (rt-environ-variable-unbound-error? cond) #t
  if cont {
    if (rt-environ-variable-unbound-error? cond) {
      ;; return #t to test
      #t
    } (error "environ unbound: unexpected condition" cond)
  } (error "environ unbound: unexpected non-continuable error" cond)
}) {
  test MYPATH #t
}

